pipeline {
  agent {
    kubernetes {
      yaml '''
        apiVersion: v1
        kind: Pod 
        metadata:
          name: kubectl
          namespace: team-cicd-controlplane
        spec:   
          containers:
          - name: kubectl
            image: alpine/k8s:1.25.14
            command:
              - cat
            tty: true
        '''    
    }
  }
    environment {
        //artifact deployment S3 bucket.    
        bucket = "confluence-assessments-task-4-enquizit-2022" 
        //artifact deployment bucket region          
        region = "us-east-1"  
        //artifact upload bucket region. (optional)                    
        region1 = "us-east-2" 
        //aws credentials                    
        aws_credential = "s3-profile" //aws credentials 
        // Dockerhub credentials to push and pull images. 
        DOCKERHUB_CREDENTIALS = "dockerhub"
        KUBERNETES_CREDENTIALS  = 'kubeernetes-seccret'
    }
  stages {
    stage('Run Command') {
      steps {
        container('kubectl') {
          withKubeConfig([credentialsId: "${KUBERNETES_CREDENTIALS}" ,
                    serverUrl: 'https://BF940C2362D0B0FBF08656E462353508.gr7.us-east-1.eks.amazonaws.com',
                    clusterName: 'cluster-stack',
                    namespace: 'team-cicd-controplane'
                    ]) {
                 sh 'kubectl get pods'
        }
      }
    }
  }
}
}
